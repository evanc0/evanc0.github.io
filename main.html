<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ê–ª—å–±–∏–æ–Ω: –ö—Ä–∞—Ñ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T4.3</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 650px;
        margin: 25px auto;
        padding: 20px;
        background-color: #f9fbfd;
        color: #2c3e50;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #2980b9;
      }
      label {
        display: block;
        margin-top: 16px;
        font-weight: bold;
      }
      input,
      select {
        width: 100%;
        padding: 9px;
        margin-top: 6px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }
      .checkbox-group {
        margin-top: 16px;
      }
      .checkbox-group input {
        width: auto;
        margin-right: 10px;
      }
      #result {
        margin-top: 25px;
        padding: 20px;
        background-color: #eaf7ff;
        border-radius: 8px;
        display: none;
        border-left: 5px solid #3498db;
      }
      .highlight {
        font-weight: bold;
        color: #27ae60;
      }
      .loss {
        color: #e74c3c;
        font-weight: bold;
      }
      .tip {
        background-color: #fff8e1;
        padding: 12px;
        border-radius: 6px;
        margin-top: 15px;
        font-size: 14px;
        border-left: 3px solid #f1c40f;
      }
    </style>
  </head>
  <body>
    <h1>ü™µ –ö—Ä–∞—Ñ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T4.3</h1>

    <label>–¶–µ–Ω–∞ –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –±—Ä–µ–≤–Ω–∞ T4.3 (—Å–µ—Ä–µ–±—Ä–æ):</label>
    <input
      type="number"
      id="rawPrice"
      value="5000"
      min="0"
      step="100"
      oninput="recalculate()"
    />

    <label>–¶–µ–Ω–∞ –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T3.0 (—Å–µ—Ä–µ–±—Ä–æ):</label>
    <input
      type="number"
      id="refinedPrice"
      value="1800"
      min="0"
      step="100"
      oninput="recalculate()"
    />

    <label>–¶–µ–Ω–∞ –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T4.3 –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ (—Å–µ—Ä–µ–±—Ä–æ):</label>
    <input
      type="number"
      id="productSellPrice"
      value="12500"
      min="0"
      step="100"
      oninput="recalculate()"
    />

    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—É–ø–ª–µ–Ω–Ω–æ–≥–æ –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –±—Ä–µ–≤–Ω–∞ T4.3:</label>
    <input
      type="number"
      id="rawAmount"
      value="200"
      min="0"
      step="1"
      oninput="recalculate()"
    />

    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—É–ø–ª–µ–Ω–Ω–æ–π –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T3.0:</label>
    <input
      type="number"
      id="refinedAmount"
      value="100"
      min="0"
      step="1"
      oninput="recalculate()"
    />

    <label>–ù–∞–ª–æ–≥ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É:</label>
    <select id="taxRate" oninput="recalculate()">
      <option value="6.5">6.5% (–ù–∞–ª–æ–≥ —Å –ø—Ä–µ–º–∏—É–º–æ–º)</option>
      <option value="10.5" selected>10.5% (–û–±—ã—á–Ω—ã–π –Ω–∞–ª–æ–≥)</option>
    </select>

    <div class="checkbox-group">
      <input type="checkbox" id="useFocus" oninput="recalculate()" />
      <label for="useFocus" style="display: inline; font-weight: normal">
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫—É (–≤–æ–∑–≤—Ä–∞—Ç 53.9% –≤–º–µ—Å—Ç–æ 36.5%)
      </label>
    </div>

    <div id="result"></div>

    <script>
      function recalculate() {
        const rawPrice =
          parseFloat(document.getElementById("rawPrice").value) || 0;
        const refinedPrice =
          parseFloat(document.getElementById("refinedPrice").value) || 0;
        const productSellPrice =
          parseFloat(document.getElementById("productSellPrice").value) || 0;
        let rawAmount =
          parseFloat(document.getElementById("rawAmount").value) || 0;
        let refinedAmount =
          parseFloat(document.getElementById("refinedAmount").value) || 0;
        const taxRate =
          parseFloat(document.getElementById("taxRate").value) || 0;
        const useFocus = document.getElementById("useFocus").checked;

        if (
          rawPrice <= 0 ||
          refinedPrice <= 0 ||
          productSellPrice <= 0 ||
          rawAmount < 0 ||
          refinedAmount < 0
        ) {
          document.getElementById("result").style.display = "none";
          return;
        }

        const refund = useFocus ? 0.539 : 0.365;
        let totalProduct = 0;
        let totalRawUsed = 0;
        let totalRefinedUsed = 0;

        // –°–∏–º—É–ª—è—Ü–∏—è –∫—Ä–∞—Ñ—Ç–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º
        while (true) {
          const possibleFromRaw = Math.floor(rawAmount / 2);
          const possibleFromRefined = Math.floor(refinedAmount);
          const craftNow = Math.min(possibleFromRaw, possibleFromRefined);

          if (craftNow <= 0) break;

          totalProduct += craftNow;
          const rawSpent = craftNow * 2;
          const refinedSpent = craftNow;

          totalRawUsed += rawSpent;
          totalRefinedUsed += refinedSpent;

          rawAmount -= rawSpent;
          refinedAmount -= refinedSpent;

          // –í–æ–∑–≤—Ä–∞—Ç
          rawAmount += rawSpent * refund;
          refinedAmount += refinedSpent * refund;
        }

        // –ò—Ç–æ–≥–æ–≤—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã (–ø–æ —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–∫—É–ø–∫–µ)
        const initialRaw =
          parseFloat(document.getElementById("rawAmount").value) || 0;
        const initialRefined =
          parseFloat(document.getElementById("refinedAmount").value) || 0;
        const totalCost = initialRaw * rawPrice + initialRefined * refinedPrice;

        const sellPriceAfterTax = productSellPrice * (1 - taxRate / 100);
        const totalRevenue = totalProduct * sellPriceAfterTax;
        const profit = totalRevenue - totalCost;
        const profitPerUnit =
          totalProduct > 0 ? Math.round(profit / totalProduct) : 0;

        const resultDiv = document.getElementById("result");
        const modeName = useFocus
          ? "—Å —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–æ–π (53.9%)"
          : "–æ–±—ã—á–Ω—ã–π (36.5%)";
        const taxInfo = ` (–Ω–∞–ª–æ–≥ ${taxRate}%)`;

        resultDiv.innerHTML = `
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (${modeName}${taxInfo}):</h3>
        <p>üîπ –ü–æ–ª—É—á–µ–Ω–æ: <span class="highlight">${totalProduct.toLocaleString()}</span> √ó –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T4.3</p>
        <p>üõí –ó–∞–∫—É–ø–ª–µ–Ω–æ: 
          <span class="highlight">${initialRaw.toLocaleString()}</span> √ó –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –±—Ä–µ–≤–Ω–∞ T4.3, 
          <span class="highlight">${initialRefined.toLocaleString()}</span> √ó –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –¥—Ä–µ–≤–µ—Å–∏–Ω—ã T3.0
        </p>
        <p>üí∞ –ó–∞—Ç—Ä–∞—Ç—ã: <span class="highlight">${Math.round(
          totalCost
        ).toLocaleString()} —Å–µ—Ä–µ–±—Ä–∞</span></p>
        <p>üìà –î–æ—Ö–æ–¥ –æ—Ç –ø—Ä–æ–¥–∞–∂–∏: <span class="highlight">${Math.round(
          totalRevenue
        ).toLocaleString()} —Å–µ—Ä–µ–±—Ä–∞</span></p>
        <p>‚úÖ –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: <span class="highlight">${Math.round(
          profit
        ).toLocaleString()} —Å–µ—Ä–µ–±—Ä–∞</span></p>
        <p>üìä –ü—Ä–∏–±—ã–ª—å –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É: <span class="highlight">${profitPerUnit.toLocaleString()} —Å–µ—Ä–µ–±—Ä–∞</span></p>
        <div class="tip">
          üí° <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∞—Ñ—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ${Math.round(
            refund * 100
          )}% —Ä–µ—Å—É—Ä—Å–æ–≤.
          –û–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –Ω–æ–≤—ã—Ö —Ü–∏–∫–ª–æ–≤ –∫—Ä–∞—Ñ—Ç–∞, –ø–æ–∫–∞ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞ 1 –µ–¥–∏–Ω–∏—Ü—É.
        </div>
      `;
        resultDiv.style.display = "block";
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      recalculate();
    </script>
  </body>
</html>
